1ï¸âƒ£ Docker ãƒ“ãƒ«ãƒ‰
docker build -t vendor1007-2-api:### -f Dockerfile.api .

2ï¸âƒ£ ECR å‘ã‘ã‚¿ã‚°ä»˜ã‘
docker tag vendor1007-2-api:### 067717894185.dkr.ecr.ap-northeast-1.amazonaws.com/vendor1007-2-api:###

3ï¸âƒ£ ECR ãƒ­ã‚°ã‚¤ãƒ³
aws ecr get-login-password --region ap-northeast-1 | \
docker login --username AWS --password-stdin 067717894185.dkr.ecr.ap-northeast-1.amazonaws.com

4ï¸âƒ£ Docker ãƒ—ãƒƒã‚·ãƒ¥
docker push 067717894185.dkr.ecr.ap-northeast-1.amazonaws.com/vendor1007-2-api:###

5ï¸âƒ£ ã‚¿ã‚¹ã‚¯å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆecs_taskdef.jsonï¼‰ã®æ›´æ–°
sed -i "s|\"image\": \".*\"|\"image\": \"067717894185.dkr.ecr.ap-northeast-1.amazonaws.com/vendor1007-2-api:###\"|" ecs_taskdef.json

6ï¸âƒ£ æ›´æ–°çµæœã®ç¢ºèª
grep image ecs_taskdef.json

7ï¸âƒ£ æ–°ã‚¿ã‚¹ã‚¯å®šç¾©ã®ç™»éŒ²
aws ecs register-task-definition \
  --cli-input-json file://ecs_taskdef.json

8ï¸âƒ£ ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ã®ç¢ºèª
aws ecs describe-task-definition --task-definition vendor1007-2-task

9ï¸âƒ£ æ–°ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã§ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ
aws ecs update-service --cluster vendor1007-2-cluster --service vendor1007-2-service --task-definition vendor1007-2-task:### --force-new-deployment

ğŸ”Ÿ ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³ã®ç¢ºèª
aws ecs describe-services --cluster vendor1007-2-cluster --services vendor1007-2-service --query "services[0].deployments[*].[status, taskDefinition, rolloutState, updatedAt]" --output table


å®¹é‡ã«å•é¡ŒãŒã‚ã£ãŸæ™‚
docker stop $(docker ps -aq) 2>/dev/null
docker rm -f $(docker ps -aq) 2>/dev/null
docker rmi -f $(docker images -q) 2>/dev/null
docker volume rm $(docker volume ls -q) 2>/dev/null
docker system prune -a --volumes -f

df -h



ğŸ§± 1ï¸âƒ£ ä»®æƒ³ç’°å¢ƒï¼ˆ.venvï¼‰ã®ä½œæˆ
python3 -m venv .venv
ã“ã‚Œã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã« .venv/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã¾ã™ã€‚

ğŸš€ 2ï¸âƒ£ ä»®æƒ³ç’°å¢ƒã®æœ‰åŠ¹åŒ–
Linux / Mac / CloudShell / EC2
source .venv/bin/activate

Windowsï¼ˆPowerShellï¼‰
.venv\Scripts\Activate.ps1


ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•
pkill -f uvicorn
uvicorn app.main:app --host 0.0.0.0 --port 8080



  
curl -X POST http://localhost:8080/api/v1/query \
  -H "Content-Type: application/json" \
  -d '{"q":"LLMå°å…¥æ”¯æ´ãŒå¾—æ„"}'

curl -X POST http://localhost:8080/api/v1/query \
  -H "Content-Type: application/json" \
  -d '{"q": "LLMå°å…¥æ”¯æ´ãŒå¾—æ„", "k": 1}'




  aws s3 sync s3://cosign-test/faiss/exp/vectorstore/vendor_cohere_v4/ /tmp/vectorstore/vendor_cohere_v4/
  ls /tmp/vectorstore/vendor_cohere_v4/