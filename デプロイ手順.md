1️⃣ Docker ビルド
docker build -t vendor1007-2-api:### -f Dockerfile.api .

2️⃣ ECR 向けタグ付け
docker tag vendor1007-2-api:### 067717894185.dkr.ecr.ap-northeast-1.amazonaws.com/vendor1007-2-api:###

3️⃣ ECR ログイン
aws ecr get-login-password --region ap-northeast-1 | \
docker login --username AWS --password-stdin 067717894185.dkr.ecr.ap-northeast-1.amazonaws.com

4️⃣ Docker プッシュ
docker push 067717894185.dkr.ecr.ap-northeast-1.amazonaws.com/vendor1007-2-api:###

5️⃣ タスク定義ファイル（ecs_taskdef.json）の更新
sed -i "s|\"image\": \".*\"|\"image\": \"067717894185.dkr.ecr.ap-northeast-1.amazonaws.com/vendor1007-2-api:###\"|" ecs_taskdef.json

6️⃣ 更新結果の確認
grep image ecs_taskdef.json

7️⃣ 新タスク定義の登録
aws ecs register-task-definition \
  --cli-input-json file://ecs_taskdef.json

8️⃣ リビジョン番号の確認
aws ecs describe-task-definition --task-definition vendor1007-2-task

9️⃣ 新リビジョンでロールアウト
aws ecs update-service --cluster vendor1007-2-cluster --service vendor1007-2-service --task-definition vendor1007-2-task:### --force-new-deployment

🔟 デプロイ状況の確認
aws ecs describe-services --cluster vendor1007-2-cluster --services vendor1007-2-service --query "services[0].deployments[*].[status, taskDefinition, rolloutState, updatedAt]" --output table


容量に問題があった時
docker stop $(docker ps -aq) 2>/dev/null
docker rm -f $(docker ps -aq) 2>/dev/null
docker rmi -f $(docker images -q) 2>/dev/null
docker volume rm $(docker volume ls -q) 2>/dev/null
docker system prune -a --volumes -f

df -h



🧱 1️⃣ 仮想環境（.venv）の作成
python3 -m venv .venv
これでプロジェクト直下に .venv/ ディレクトリが作成されます。

🚀 2️⃣ 仮想環境の有効化
Linux / Mac / CloudShell / EC2
source .venv/bin/activate

Windows（PowerShell）
.venv\Scripts\Activate.ps1


バックエンド起動
pkill -f uvicorn
uvicorn app.main:app --host 0.0.0.0 --port 8080



  
curl -X POST http://localhost:8080/api/v1/query \
  -H "Content-Type: application/json" \
  -d '{"q":"LLM導入支援が得意"}'

curl -X POST http://localhost:8080/api/v1/query \
  -H "Content-Type: application/json" \
  -d '{"q": "LLM導入支援が得意", "k": 1}'




  aws s3 sync s3://cosign-test/faiss/exp/vectorstore/vendor_cohere_v4/ /tmp/vectorstore/vendor_cohere_v4/
  ls /tmp/vectorstore/vendor_cohere_v4/